function t(t,e){const n=new File([e],"random-start.sgf",{type:"application/x-go-sgf"});t.href&&URL.revokeObjectURL(t.href),t.href=URL.createObjectURL(n),t.download=n.name}function e(t){return String.fromCharCode(96+t)}function n({col:t,row:n}){return`[${e(t)}${e(n)}]`}function r(t,{komi:e,size:r}){const[o]=(new Date).toISOString().split("T"),s=t.filter(({player:t})=>"B"===t).map(n).join(""),a=t.filter(({player:t})=>"W"===t).map(n).join("");return`(;GM[1]FF[4]CA[UTF-8]AP[random-go-stones:1.0.0]KM[${e}]SZ[${r}]DT[${o}]${s?"AB"+s:""}${a?"AW"+a:""})`}function o(t,{class:e={},data:n={},text:r="",attrs:o={}},{appendTo:s,query:a}){const i=s.querySelector(a),c=i||document.createElementNS("http://www.w3.org/2000/svg",t);if(!(c instanceof SVGElement))throw new Error("unreachable");return Object.entries(o).forEach(([t,e])=>{c.setAttribute(t,e)}),Object.entries(e).forEach(([t,e])=>{e?c.classList.add(t):c.classList.remove(t)}),Object.entries(n).forEach(([t,e])=>{null===e?delete c.dataset[t]:c.dataset[t]=""+e}),c.textContent=r,s&&!i&&s.appendChild(c),c}function s({col:t,row:e,player:n},r){return`${r+1}: ${n} ${function(t){const e=t<9?0:1;return String.fromCodePoint(t+e+64)}(t)}${20-e}`}function a([t,e],n,{preventAdjacent:r}){return n.every(({col:n,row:o})=>r?n===t?e<o-1||o+1<e:o!==e||(t<n-1||n+1<t):!(n===t&&o===e))}function i(t,e){return t.length<e||t.length%2==e%2?"B":"W"}function c(t,e){return e-t+1}function l(t,e){return Array.from(Array(c(t,e)).keys()).map(e=>e+t)}function h(t){if(t.some(t=>t<0))throw new Error("negative weight");if(t.every(t=>0===t))throw new Error("weights all zero");const e=t.reduce((t,e)=>t+e,0),n=Math.floor(Math.random()*e);return function(t){const e=Array(t.length);return t.reduce((t,n,r)=>e[r]=t+n,0),e}(t).findIndex(t=>t>n)}function u(t,e=Array.from({length:t.length}).fill(1)){if(t.length!==e.length)throw new Error("Unequal length");return t[h(e)]}function f(t){return function([e,n]){return e*t+n}}function m(t){return function(e){return[Math.floor(e/t),e%t]}}function d(t,e){return e[0]>=0&&e[0]<t[0]&&e[1]>=0&&e[1]<t[1]}function p(t,[e,n]){const r=[];return[[1,0],[0,1]].forEach(([o,s])=>{[-1,1].forEach(a=>{const i=[e+a*o,n+a*s];d(t,i)&&r.push(i)})}),r}function w(t,e){const n=[];return t.forEach(([t,r])=>{const o=i(n,e);n.push({col:t,row:r,player:o})}),n}function g(t){const e=[];return function(t){const e=[];return l(0,Math.floor(t/2)).forEach(n=>{e.push([n,t-n])}),e}(t).forEach(([t,n])=>{[[t,n],[n,t]].forEach(([t,n])=>{[[1,1],[-1,1],[1,-1],[-1,-1]].forEach(([r,o])=>{const s=[r*t,o*n];e.some(t=>t[0]===s[0]&&t[1]===s[1])||e.push(s)})})}),e}class E{constructor(t,e){this.size=t,this.weights=Array.from({length:Math.pow(this.size,2)}).fill(1),this.separation=e,this.toVh=m(t),this.fromVh=f(t)}maxRadius(t){const[e,n]=this.toVh(t),r=this.size-1;return Math.max(e,r-e)+Math.max(n,r-n)}indicesCircleTaxicab(t,e){return g(e).map(([e,n])=>{const[r,o]=this.toVh(t);return[r+e,o+n]}).filter(t=>d([this.size,this.size],t)).map(t=>this.fromVh(t))}placeStone(){const t=h(this.weights);this.weights[t]=0,l(1,this.separation).forEach(e=>{this.indicesCircleTaxicab(t,e).forEach(t=>{this.weights[t]=0})}),l(1+this.separation,this.maxRadius(t)).forEach(e=>{this.indicesCircleTaxicab(t,e).forEach(t=>{this.weights[t]*=e})});const e=2*function(t){const e=t.slice().sort((t,e)=>t-e),n=e.findIndex(t=>t>0),r=e.length-n,o=n+Math.floor(r/2);return r%2?e[o]:(e[o-1]+e[o])/2}(this.weights);return this.weights=this.weights.map(t=>Math.min(t,e)),this.toVh(t)}}class y{constructor(t=[0,0],e=[0,0]){this.corners=[t,e]}randomPoint(t){const e=[this.corners[0][0],this.corners[0][1]];return l(0,1).forEach(n=>{const r=this.corners[0][n],o=this.corners[1][n],s=l(0,c(r,o)-1),a=function(t,e,n){const r=c(e,n);if(1===r)return[1];const o=Math.floor(r/2),s=l(1,o);let a=[];return a=e===t[0]?a.concat(Array.from({length:s.length}).fill(o)):a.concat(s),r%2==1&&a.push(o),a=n===t[1]?a.concat(Array.from({length:s.length}).fill(o)):a.concat(s.reverse()),a}(t,r,o);e[n]+=u(s,a)}),e}}function M(t,e){return t+e-1}function v(t,e,n){let r=t;const o=Array.from({length:e.length});return e.forEach((t,e)=>{o[e]=[r,M(r,t)],r+=t+n}),o}class T{constructor(t,e,n,r){this.lens=[r[0].length,r[1].length],this.weights=Array.from({length:this.lens[0]*this.lens[1]}).fill(1<<t),this.rects=Array.from({length:this.lens[0]*this.lens[1]},()=>new y),this.fromVh=f(this.lens[1]),this.toVh=m(this.lens[1]);const o=[v(e,r[0],n),v(e,r[1],n)];this.rects.forEach((t,e)=>{const n=this.toVh(e);l(0,1).forEach(e=>{l(0,1).forEach(r=>{t.corners[r][e]=o[e][n[e]][r]})})})}decrementWeights(t){t.forEach(t=>this.weights[t]>>=1)}randomPairs(t){const e=[];return l(1,t).forEach(()=>{let t,n,r;do{t=h(this.weights),n=p(this.lens,this.toVh(t)).map(t=>this.fromVh(t)).sort((t,e)=>t-e),r=this.weights.filter((t,e)=>n.includes(e))}while(0===Math.max(...r));const o=u(n,r);this.weights[t]=0,this.decrementWeights(n),this.weights[o]=0,this.decrementWeights(p(this.lens,this.toVh(o)).map(t=>this.fromVh(t)));const s=[t,o].sort((t,e)=>t-e);e.push(new y(this.rects[s[0]].corners[0],this.rects[s[1]].corners[1]))}),e}}class A extends Error{}function b({start:t=3,end:e=17}){return t+Math.floor(Math.random()*(e-t)+1)}function I({start:t=3,end:e=17}){return t+Math.floor(Math.random()*(e-t)+1)}const L={dominoShuffle:function(t,{size:e,margins:n,handicap:r,preventAdjacent:o}){const s=o?1:0,a=[1+n,e-n];let i;try{i=function(t,e,n,r,o){const s=[[],[]];return l(0,1).forEach(a=>{const i=t-2*e-n*(o[a]-1),h=Math.floor(i/o[a]);if(h<1)throw new A;let f=c(r[0],r[1]);l(1,o[a]-1).reverse().forEach(t=>{const e=u(l(h,f-(h+n)*t));s[a].push(e),f-=e+n}),s[a].push(f)}),s}(e,n,s,a,function(t){const e=[0,0];let n=1;for(;e[0]*e[1]<3*t;)n%2?e[0]+=1:e[1]+=1,n+=1;return e}(t))}catch(t){throw t instanceof A?new Error("Error: not enough space on the board for the parameters"):t}const h=[];return new T(t,a[0],s,i).randomPairs(t).forEach(t=>{h.push(t.randomPoint(a))}),w(h,r)},quadrantShuffle:function t(e,n,r={placements:[],quadrantMask:15,quadrant:0}){if(e<=0)return r.placements;const o=function(t){const e=Array.from(t.toString(2).padStart(4,"0"),t=>Number.parseInt(t,10)).reverse(),n=e.reduce((t,e)=>t+e,0);if(1===n)return t;let r=Math.floor(Math.random()*n)+1;return 1<<e.findIndex(t=>(t&&(r-=1),0===r))}(r.quadrantMask);return r.quadrant=o,r.quadrantMask=r.quadrantMask^o||15,r.placements.push(function t(e,n){const{placements:r,quadrant:o}=e,{size:s,margins:c,handicap:l,preventAdjacent:h}=n;let u=c+1,f=s-c,m=c+1,d=s-c;const p=(s+1)/2;8===o?(f=p,d=p):4===o?(u=p,d=p):2===o?(f=p,m=p):1===o&&(u=p,m=p);const w=b({start:u,end:f}),g=b({start:m,end:d});return a([w,g],r,{preventAdjacent:h})?{col:w,row:g,player:i(r,l)}:t(e,n)}(r,n)),t(e-1,n,r)},uniform:function t(e,n,r={placements:[]}){return e<=0?r.placements:(r.placements.push(function t(e,n){const{size:r,margins:o,handicap:s,preventAdjacent:c}=n,l=o+1,h=r-o,u=I({start:l,end:h}),f=I({start:l,end:h});return a([u,f],e,{preventAdjacent:c})?{col:u,row:f,player:i(e,s)}:t(e,n)}(r.placements,n)),t(e-1,n,r))},adaptiveWeights:function(t,{size:e,margins:n,handicap:r,preventAdjacent:o}){const s=new E(e-2*n,o?1:0),a=[];return l(1,t).forEach(()=>{a.push(s.placeStone())}),w(a.map(([t,e])=>[1+n+t,1+n+e]),r)}};function S(t,e){return new URLSearchParams([...Object.entries(e),["placements",t.map(({col:t,row:e,player:n})=>`${n}[${String.fromCharCode(96+t)}${String.fromCharCode(96+e)}]`).join("")]])}function q(e,n,a){const i=e.querySelector("data"),c=e.querySelector("pre");i&&c&&(i.value=JSON.stringify({...a,placements:n}),c.textContent=function(t){return t.map(s).join("\n")}(n));const l=document.getElementById("demo-board");l instanceof SVGSVGElement&&function(t,e,{size:n}){const r=100/n,s=r/2-.35,a=o("g",{class:{board:!0},data:{size:n},attrs:{transform:`translate(${s}, ${s})`,"aria-label":`${n}Ã—${n} board`}},{appendTo:t,query:".board"});{const t=o("g",{class:{gridlines:!0},attrs:{"aria-hidden":"true"}},{appendTo:a,query:".gridlines"}),e=o("g",{class:{"h-lines":!0}},{appendTo:t,query:".h-lines"}),s=o("g",{class:{"v-lines":!0}},{appendTo:t,query:".v-lines"});for(let t=0;t<n;t+=1){const n=`line:nth-child(${t+1})`;o("line",{attrs:{x1:"0",x2:""+(100-r),y1:""+t*r,y2:""+t*r},class:{"h-line":!0}},{appendTo:e,query:n}),o("line",{attrs:{x1:""+t*r,x2:""+t*r,y1:"0",y2:""+(100-r)},class:{"v-line":!0}},{appendTo:s,query:n})}for(;e.children[n];)e.children[n].remove();for(;s.children[n];)s.children[n].remove()}{const t=o("g",{class:{starpoints:!0},attrs:{"aria-hidden":"true"}},{appendTo:a,query:".starpoints"}),e=""+Math.max(.666,r/10),s=n<13?2:3,i=n%2==0?n-2*s-1:(n-2*s-1)/2;let c=0;for(let a=s;a<n-1;a+=i)for(let l=s;l<n-1;l+=i)c+=1,o("circle",{attrs:{cx:""+a*r,cy:""+l*r,r:e},class:{starpoint:!0}},{appendTo:t,query:`.starpoint:nth-child(${c})`});for(;t.children[c];)t.children[c].remove()}{const t=o("g",{attrs:{"aria-label":"stones"},class:{stones:!0}},{appendTo:a,query:".stones"});e.forEach(({col:a,row:i,player:c},l)=>{const h="B"===c?"black":"white",u=o("circle",{attrs:{cx:""+(a-1)*r,cy:""+(i-1)*r,r:""+s,fill:h},class:{stone:!0},data:{player:c}},{appendTo:t,query:`.stone:nth-child(${l+1})`});for(o("title",{text:`${h} ${String.fromCodePoint(64+a)}${n-i+1}`},{appendTo:u,query:"title"});t.children[e.length];)t.children[e.length].remove()})}}(l,n,a);const h=document.getElementById("download-anchor");h instanceof HTMLAnchorElement&&t(h,r(n,a))}function x(t){const{elements:e}=t,n=e.namedItem("stones"),r=e.namedItem("size"),o=e.namedItem("komi"),s=e.namedItem("handicap"),a=e.namedItem("margins"),i=e.namedItem("preventAdjacent"),c=e.namedItem("generator");if(!(n instanceof HTMLInputElement&&r instanceof HTMLInputElement&&o instanceof HTMLInputElement&&s instanceof HTMLInputElement&&a instanceof HTMLInputElement&&i instanceof HTMLInputElement&&c instanceof RadioNodeList))throw new Error("DOM Failure");const l=c.value;if("dominoShuffle"!==l&&"quadrantShuffle"!==l&&"uniform"!==l&&"adaptiveWeights"!==l)throw new Error("Generator not supported");return{stones:n.valueAsNumber,size:r.valueAsNumber,komi:o.valueAsNumber,handicap:s.valueAsNumber,margins:a.valueAsNumber,preventAdjacent:i.checked,generator:l}}function O(t){t.preventDefault();const e=t.target;if(!(e instanceof HTMLFormElement))throw new Error("DOM failure");const n=x(e),r=n.handicap+2*n.stones,o=L[n.generator](r,n),s=e.elements.namedItem("placements");if(!(s instanceof HTMLOutputElement))throw new Error("DOM failure");q(s,o,n),window.history.replaceState(null,"","?"+S(o,n))}function $(e){const n=e.target;if(!(n instanceof HTMLInputElement))throw new Error("DOM failure");const{form:o}=n;if(!(o instanceof HTMLFormElement))throw new Error("DOM failure");const s=o.elements.namedItem("placements");if(!(s instanceof HTMLOutputElement))throw new Error("DOM failure");const a=s.querySelector("data");if(!a)throw new Error("DOM failure");if(!a.value)return;const{placements:i,...c}=JSON.parse(a.value);c.komi=o.komi.valueAsNumber,a.value=JSON.stringify({...c,placements:i});const l=document.getElementById("download-anchor");if(!(l instanceof HTMLAnchorElement))throw new Error("DOM failure");t(l,r(i,c)),window.history.replaceState(null,"","?"+S(i,c))}import("./focus-visible-46ab8056.js").catch(t=>{console.warn("Failed to import focus-visible"),console.error(t)}),document.addEventListener("DOMContentLoaded",(function(){const{searchParams:t}=new URL(window.location.href),e=document.getElementById("generator-form");if(!(e instanceof HTMLFormElement))throw new Error("DOM not ready");let n=[];for(const[r,o]of t){if("placements"===r){n=o.split("]").slice(0,-1).map(t=>{const[e,n]=t.split("[");if("B"!==e&&"W"!==e)throw new Error("Illegal SGF. player must be B or W");if(!n||2!==n.length)throw new Error("Illegal SGF. Coordinate must be two letters");return{player:e,col:(n.codePointAt(0)??0)-96,row:(n.codePointAt(1)??0)-96}});continue}const t=e.elements.namedItem(r);t&&(t instanceof HTMLInputElement&&"checkbox"===t.type?t.checked="true"===o:(t instanceof HTMLInputElement||t instanceof RadioNodeList)&&(t.value=o))}const r=e.elements.namedItem("placements");if(!(r instanceof HTMLOutputElement))throw new Error("DOM failure");q(r,n,x(e)),e.addEventListener("submit",O);const o=e.elements.namedItem("komi");o instanceof HTMLElement&&o.addEventListener("change",$)}));
